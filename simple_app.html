<!DOCTYPE html>
<html>
<head>
    <title>Simple Veritas-AI</title>
    <style>
        body { font-family: Arial; background: #111; color: white; text-align: center; }
        video { border: 2px solid #333; border-radius: 10px; }
        #riskContainer { width: 640px; height: 25px; background: #333; margin: 20px auto; border-radius: 20px; overflow: hidden; }
        #riskBar { height: 100%; width: 0%; background: green; transition: width 0.2s ease; }
        #status { white-space: pre-line; background: #222; padding: 15px; border-radius: 10px; max-width: 640px; margin: 20px auto; }
    </style>
</head>
<body>
    <h2>ðŸ”¥ Simple Veritas-AI</h2>
    
    <video id="video" autoplay width="640" height="480"></video>
    
    <div id="riskContainer">
        <div id="riskBar"></div>
    </div>
    
    <pre id="status">Loading...</pre>
    
    <!-- Load face-api -->
    <script src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>
    
    <!-- All code in one file - no imports -->
    <script>
        // DOM elements
        const video = document.getElementById('video');
        const riskBar = document.getElementById('riskBar');
        const status = document.getElementById('status');
        
        // Simple scoring functions (copied from your modules)
        function computeBehavioralScore(landmarks) {
            return Math.random() * 0.5; // Placeholder
        }
        
        function computeStructuralScore(landmarks) {
            return Math.random() * 0.5; // Placeholder
        }
        
        function computeFaceTexture() {
            return Math.random() * 0.5; // Placeholder
        }
        
        function computeFrameTexture() {
            return Math.random() * 0.5; // Placeholder
        }
        
        function computeTextureScore(face, frame) {
            return (face + frame) / 2;
        }
        
        function computeISI(scores) {
            return (scores.structural + scores.behavioral + scores.texture) / 3;
        }
        
        function getRiskLabel(isi) {
            if (isi < 0.3) return "Low Risk";
            if (isi < 0.6) return "Medium Risk";
            return "High Risk";
        }
        
        // Load models and start
        async function init() {
            status.innerText = 'Loading models...';
            
            try {
                // Load from CDN
                await faceapi.nets.tinyFaceDetector.load(
                    'https://raw.githubusercontent.com/justadudewhohacks/face-api.js/master/weights/tiny_face_detector_model-weights_manifest.json'
                );
                
                await faceapi.nets.faceLandmark68Net.load(
                    'https://raw.githubusercontent.com/justadudewhohacks/face-api.js/master/weights/face_landmark_68_model-weights_manifest.json'
                );
                
                status.innerText = 'Models loaded! Starting webcam...';
                
                // Start webcam
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                video.srcObject = stream;
                
                status.innerText = 'Webcam started. Detecting faces...';
                
                // Start detection loop
                setInterval(async () => {
                    try {
                        const detection = await faceapi
                            .detectSingleFace(video, new faceapi.TinyFaceDetectorOptions())
                            .withFaceLandmarks();
                        
                        if (!detection) {
                            status.innerText = 'No face detected';
                            riskBar.style.width = '0%';
                            return;
                        }
                        
                        // Calculate scores
                        const landmarks = detection.landmarks.positions;
                        const behavioral = computeBehavioralScore(landmarks);
                        const structural = computeStructuralScore(landmarks);
                        const faceTexture = computeFaceTexture();
                        const frameTexture = computeFrameTexture();
                        const texture = computeTextureScore(faceTexture, frameTexture);
                        
                        const isi = computeISI({ structural, behavioral, texture });
                        const label = getRiskLabel(isi);
                        
                        // Update UI
                        const percentage = (isi * 100).toFixed(0);
                        riskBar.style.width = percentage + '%';
                        
                        if (isi < 0.3) riskBar.style.backgroundColor = 'green';
                        else if (isi < 0.6) riskBar.style.backgroundColor = 'orange';
                        else riskBar.style.backgroundColor = 'red';
                        
                        status.innerText = `Risk: ${percentage}% (${label})`;
                        
                    } catch (err) {
                        console.error('Detection error:', err);
                    }
                }, 300);
                
            } catch (err) {
                status.innerText = 'Error: ' + err.message;
                console.error(err);
            }
        }
        
        // Start
        init();
    </script>
</body>
</html>